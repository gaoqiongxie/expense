<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
 <mapper namespace="com.xw.restful.dao.FmlExpenseDao">
 	<resultMap type="com.xw.restful.domain.FmlExpense" id="fmlExpense">
		<id column="id" property="expenseId" jdbcType="INTEGER" />
		<result column="member_id" property="memberId" jdbcType="INTEGER" />
		<result column="payer_id" property="payerId" jdbcType="INTEGER" />
		<result column="expense" property="expense" jdbcType="FLOAT" />
		<result column="expense_type" property="expenseType" jdbcType="INTEGER" />
		<result column="expense_desc" property="expenseDesc" jdbcType="VARCHAR" />
		<result column="expense_time" property="expenseTime" jdbcType="TIMESTAMP" />
		<result column="data_state" property="dataState" jdbcType="VARCHAR" />
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
	</resultMap>
	
	<resultMap type="com.xw.restful.domain.ExpenseType" id="expenseType">
		<id column="type_id" property="typeId" jdbcType="INTEGER" />
		<result column="type_name" property="typeName" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap type="com.xw.restful.domain.vo.ExpenseVO" id="fmlExpenseVO">
		<id column="id" property="recordId" jdbcType="INTEGER" />
		<result column="expense_id" property="expenseId" jdbcType="INTEGER" />
		<result column="payer_id" property="payerId" jdbcType="INTEGER" />
		<result column="expense_name" property="expenseName" jdbcType="INTEGER" />
		<result column="payer" property="payer" jdbcType="VARCHAR" />
		<result column="expense" property="expense" jdbcType="VARCHAR" />
		<result column="expense_desc" property="expenseDesc" jdbcType="VARCHAR" />
		<result column="expense_Time" property="expenseTime" jdbcType="TIMESTAMP" />
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
		<result column="date_state" property="expenseDateState" jdbcType="VARCHAR" />
		<result column="type_id" property="typeId" jdbcType="INTEGER" />
		<result column="type_name" property="typeName" jdbcType="VARCHAR" />
	</resultMap>
	
	<select id="expenseVO" resultMap="fmlExpenseVO">
		select d.id id, m.id expense_id ,m.name expense_name,p.id payer_id,p.name payer,
		expense, expense_desc, expense_time, update_time, d.data_state
		from fml_expense d left join fml_member m on d.member_id=m.id 
		left join fml_member p on d.payer_id=p.id 
		where data_state='init' order by update_time asc 
		<if test="pageSize != 0">
			limit #{page},#{pageSize}
		</if>
	</select>
	
	<select id="getDtoRecordById" resultMap="fmlExpenseVO">
		select d.id id, m.id expense_id ,m.name expense_name,p.id payer_id,p.name payer,
		expense,expense_desc,expense_time ,update_time, d.data_state,t.type_id,t.type_name
		from fml_expense d left join fml_member m on d.member_id=m.id 
		left join expense_type t on d.expense_type=t.type_id
		left join fml_member p on d.payer_id=p.id 
		where d.id=#{id}
	</select>

</mapper>